KSHSettings
{
	harvestersSystemPowerCoeff = 120
	convertersSystemPowerCoeff = 120
}

//
// Harvesters
//

@PART[*]:HAS[@MODULE[Harvester]:HAS[~type[]]]:NEEDS[ProfileDefault,SystemHeat]:BEFORE[zzzz_SystemHeat]
{
	@MODULE[Harvester]:HAS[~type[]],*
	{
		%type = 0
	}
}
@PART[*]:HAS[@MODULE[Harvester]:HAS[~min_abundance[]]]:NEEDS[ProfileDefault,SystemHeat]:BEFORE[zzzz_SystemHeat]
{
	@MODULE[Harvester]:HAS[~min_abundance[]],*
	{
		%min_abundance = 0.0
	}
}
@PART[*]:HAS[@MODULE[Harvester]:HAS[~resource[]]]:NEEDS[ProfileDefault,SystemHeat]:BEFORE[zzzz_SystemHeat]
{
	@MODULE[Harvester]:HAS[~resource[]],*
	{
		%resource = Ore
	}
}
@PART[*]:HAS[@MODULE[Harvester]:HAS[~rate[]]]:NEEDS[ProfileDefault,SystemHeat]:BEFORE[zzzz_SystemHeat]
{
	@MODULE[Harvester]:HAS[~rate[]],*
	{
		%rate = 0.0025
	}
}
@PART[*]:HAS[@MODULE[Harvester]:HAS[~ec_rate[]]]:NEEDS[ProfileDefault,SystemHeat]:BEFORE[zzzz_SystemHeat]
{
	@MODULE[Harvester]:HAS[~ec_rate[]],*
	{
		%ec_rate = 1.0
	}
}

// Convert all Kerbalism Harvester module to SystemHeatHarvesterKerbalism
// Patch Configure module accordingly
@PART[*]:HAS[@MODULE[Harvester]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	!MODULE[ModuleSystemHeat],* {}
	MODULE
	{
		name = ModuleSystemHeat
		// Cubic metres
		volume = #$/mass$ // 1 ton equals 1 cubic meter of cooling. it *very roughly* approximates the balance of squads ISRU
		moduleID = harvester
		iconName = Icon_Drill
	}

	@MODULE[Harvester],*
	{
		@name = SystemHeatHarvesterKerbalism
		%ConverterName = #$title$
		%HarvesterType = #$type$
		%HarvestThreshold = #$min_abundance$
		%ResourceName = #$resource$
		%Efficiency = #$rate$
		%AutoShutdown = true
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = #$../ec_rate$
		}

		%moduleID = #$title$
		%GeneratesHeat = false
		%systemHeatModuleID = harvester
		%shutdownTemperature = 750
		%systemOutletTemperature = 350
		!systemEfficiency{}
		systemEfficiency
		{
			key = 0 1.0
			key = 400 1.0
			key = 650 0.0
		}
		%systemPower = #$ec_rate$
		@systemPower *= #$rate$
		@systemPower *= #$@KSHSettings/harvestersSystemPowerCoeff$

		!title = DELETE
		!type = DELETE
		!min_abundance = DELETE
		!resource = DELETE
		!rate = DELETE
		!ec_rate = DELETE
	}

	@MODULE[Harvester]:HAS[#drill[*]],*
	{
		%ImpactTransform = #$drill$
		!drill = DELETE
	}
	@MODULE[Harvester]:HAS[#length[*]],*
	{
		%ImpactRange = #$length$
		!length = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*],*
		{
			@MODULE[*]
			{
				%type = SystemHeatHarvesterKerbalism
				%id_field = ResourceName
			}
		}
	}

	!MODULE[Reliability],* {}
	MODULE:NEEDS[FeatureReliability]
	{
		name = Reliability
		type = SystemHeatHarvesterKerbalism
		title = #KERBALISM_Harvester_title // Harvester
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.0
		extra_mass = 0.2
	}
}


//
// Converters
//
// Not all ProcessController modules will be converted to SystemHeatConverterKerbalism modules
// Fuel cells and life support modules should be left untouched

// Water electrolysis
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_WaterElectrolysis]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_WaterElectrolysis]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0008043014
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 2.4026694940
			@Ratio *= #$../capacity$
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 1.0011122892
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.5065967413
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _WaterElectrolysis
		%systemHeatModuleID = isru
		%shutdownTemperature = 1000
		%systemOutletTemperature = 800 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 2.4026694940 //set the heat ouput as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_WaterElectrolysis]]]
		{
			@MODULE[*]:HAS[#id_value[_WaterElectrolysis]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Sabatier process
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_Sabatier]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_Sabatier]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 3.490273221
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 13.87826691
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.008082126
			@Ratio *= #$../capacity$
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.005574954
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = LiquidFuel
			Ratio = 0.000496445
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _Sabatier
		%systemHeatModuleID = isru
		%shutdownTemperature = 900
		%systemOutletTemperature = 700 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.008082126 // set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 // lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false // disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_Sabatier]]]
		{
			@MODULE[*]:HAS[#id_value[_Sabatier]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Haber process
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_Haber]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_Haber]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = Nitrogen
			Ratio = 1.3315033550
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 4.0
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.00594773
			@Ratio *= #$../capacity$
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Ammonia
			Ratio = 2.6336940144
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _Haber
		%systemHeatModuleID = isru
		%shutdownTemperature = 900
		%systemOutletTemperature = 700 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.00594773 // set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 // lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false // disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_Haber]]]
		{
			@MODULE[*]:HAS[#id_value[_Haber]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Waste incinerator
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_WasteIncinerator]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_WasteIncinerator]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = Waste
			Ratio = 0.0001082667
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.1589194249
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0000131259
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 0.1497439605
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.005
			DumpExcess = true
			@Ratio *= #$../capacity$
		}

		%moduleID = _WasteIncinerator
		%systemHeatModuleID = isru
		%shutdownTemperature = 800
		%systemOutletTemperature = 500 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.005 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_WasteIncinerator]]]
		{
			@MODULE[*]:HAS[#id_value[_WasteIncinerator]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Waste compressor
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_WasteCompressor]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_WasteCompressor]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 1.2
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = Waste
			Ratio = 0.0000045525
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Shielding
			Ratio = 0.00000001602982
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _WasteCompressor
		%systemHeatModuleID = isru
		%shutdownTemperature = 700
		%systemOutletTemperature = 400 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 1.2 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_WasteCompressor]]]
		{
			@MODULE[*]:HAS[#id_value[_WasteCompressor]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Anthraquinone process
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_Anthraquinone]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_Anthraquinone]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = Hydrogen
			Ratio = 2.0
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 2.0241355411
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxidizer
			Ratio = 0.0006067662
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _Anthraquinone
		%systemHeatModuleID = isru
		%shutdownTemperature = 700
		%systemOutletTemperature = 400 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.005 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_Anthraquinone]]]
		{
			@MODULE[*]:HAS[#id_value[_Anthraquinone]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Hydrazine production
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_HydrazineProduction]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_HydrazineProduction]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.023871584
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = Ammonia
			Ratio = 4.7203389609
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxidizer
			Ratio = 0.0014500000
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0057597534
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 1.2092781475
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = MonoPropellant
			Ratio = 0.0008537763
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _HydrazineProduction
		%systemHeatModuleID = isru
		%shutdownTemperature = 700
		%systemOutletTemperature = 400 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.023871584 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_HydrazineProduction]]]
		{
			@MODULE[*]:HAS[#id_value[_HydrazineProduction]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Hydrazine production N2 injection
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_NitroHydrazine]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_NitroHydrazine]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.059678961
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = Ammonia
			Ratio = 4.7203389609
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxidizer
			Ratio = 0.0014500000
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Nitrogen
			Ratio = 3.5796568216
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 4.8371125902
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = MonoPropellant
			Ratio = 0.0021344406
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _NitroHydrazine
		%systemHeatModuleID = isru
		%shutdownTemperature = 700
		%systemOutletTemperature = 400 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 300 1.0
			key = 1000 1.0
			key = 1300 0.0
		}
		%systemPower = 0.059678961 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_NitroHydrazine]]]
		{
			@MODULE[*]:HAS[#id_value[_NitroHydrazine]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Molten regolith electrolysis
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_MRE]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_MRE]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 2.0
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = Ore
			Ratio = 0.00006342
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 0.088843
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 0.00444215
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Shielding
			Ratio = 0.000000112
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _MRE
		%systemHeatModuleID = isru
		%shutdownTemperature = 2500
		%systemOutletTemperature = 2300 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 1500 1.0
			key = 2300 1.0
			key = 2700 0.0
		}
		%systemPower = 2.0 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_MRE]]]
		{
			@MODULE[*]:HAS[#id_value[_MRE]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Solid oxide electrolysis
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_SOE]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_SOE]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.010835259
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = CarbonDioxide
			Ratio = 2.0
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 2.0121270980
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Shielding
			Ratio = 0.0000046953
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _SOE
		%systemHeatModuleID = isru
		%shutdownTemperature = 1400
		%systemOutletTemperature = 1125 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 600 1.0
			key = 1000 1.0
			key = 1500 0.0
		}
		%systemPower = 0.010835259 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_SOE]]]
		{
			@MODULE[*]:HAS[#id_value[_SOE]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
// Selective catalytic oxidation
@PART[*]:HAS[@MODULE[ProcessController]:HAS[#resource[_SCO]]]:NEEDS[ProfileDefault,SystemHeat]:FOR[zzzz_SystemHeat]
{
	@MODULE[ProcessController]:HAS[#resource[_SCO]]
	{
		@name = SystemHeatConverterKerbalism

		%ConverterName = #$title$
		%AutoShutdown = true
		%GeneratesHeat = false
		%UseSpecialistBonus = false
		%UseSpecialistHeatBonus = false

		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 0.007166717
			@Ratio *= #$../capacity$
		}
		INPUT_RESOURCE
		{
			ResourceName = Ammonia
			Ratio = 2.0
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = Oxygen
			Ratio = 1.5371075987
			@Ratio *= #$../capacity$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Nitrogen
			Ratio = 1.0111298789
			@Ratio *= #$../capacity$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = Water
			Ratio = 0.0024403982
			@Ratio *= #$../capacity$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}

		%moduleID = _SCO
		%systemHeatModuleID = isru
		%shutdownTemperature = 1000
		%systemOutletTemperature = 700 // temp for freeing water from hydrate regolith. other values could be: 400k for production of hydrazine, 5-600k for decomposition of hydrates, 700 for sabatier process, 373-1000k for high temp electrolysis of water.
		!systemEfficiency {}
		systemEfficiency
		{
			key = 0 0.0
			key = 400 1.0
			key = 800 1.0
			key = 1100 0.0
		}
		%systemPower = 0.007166717 //set the heat output as proportional to the EC usage.
		@systemPower *= #$capacity$
		@systemPower *= #$@KSHSettings/convertersSystemPowerCoeff$
		@systemPower *= .90 //lets assume 90% of EC usage turns into heat.
		%GeneratesHeat = false //disable stock heating 

		!resource = DELETE
		!title = DELETE
		!capacity = DELETE
	}

	@MODULE[Configure]
	{
		@SETUP[*]:HAS[@MODULE[*]:HAS[#id_value[_SCO]]]
		{
			@MODULE[*]:HAS[#id_value[_SCO]]
			{
				%type = SystemHeatConverterKerbalism
				%id_field = moduleID
			}
		}
	}
}
